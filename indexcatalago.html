<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo de Productos - Nombre Negocio</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }
        header {
            background-color: #fff;
            padding: 20px;
            text-align: center;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .business-info {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
        }
        .business-info img {
            max-height: 80px;
            margin-right: 20px;
        }
        .business-info h1 {
            margin: 0;
            color: #333;
        }
        #welcome-message {
            font-size: 1.1em;
            color: #555;
            margin-bottom: 15px;
        }
        .contact-info {
            font-size: 0.9em;
            color: #666;
        }
        .contact-info p {
            margin: 5px 0;
        }
        #announcements {
            background-color: #ffffcc;
            padding: 15px;
            border-left: 4px solid #ffcc00;
            margin-bottom: 20px;
            border-radius: 4px;
            color: #555;
        }
        .filter-container {
            margin-bottom: 20px;
            text-align: center;
        }
        .filter-button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s ease;
        }
        .filter-button:hover {
            background-color: #0056b3;
        }
        .filter-button.active {
            background-color: #28a745;
        }
        .category {
            margin-bottom: 30px;
        }
        .category h2 {
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
            margin-bottom: 20px;
            color: #007bff;
        }
        .catalog-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        .product {
            background-color: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .product img {
            max-width: 100%;
            height: 150px; /* Altura fija para las imágenes */
            object-fit: contain; /* Para que la imagen se ajuste sin distorsionarse */
            margin-bottom: 10px;
        }
         .product img.error {
            /* Estilo para imágenes que no cargan */
            content: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICAgIDxwYXRoIGZpbGw9IiNjY2MiIGQ9Ik0yMSA3VjZhMSAxIDAgMCAwLTEtMUg0YTEgMSAwIDAgMC0xIDF2MTJhMSAxIDAgMCAwIDEgMWgxNiAxIDEgMCAwIDAtMS0xVjguNDg5bDEuNjUgMS42NUExIDEgMCAwIDEgMjEgMTBoMFY3ek01IDhoMTQuNDg5bC0xLjU0NSAxLjU0NUEyIDIgMCAwIDAtMTYgMTNoMGEtMi0yIDAgMCAwIDItMlY4LjQ4OVpNOCAxNGE0IDQgMCAxIDEgMCA4IDQgNCAwIDAgMSAwLTh6bTAgNmEzIDMgMCAxIDAgMC02IDMgMyAwIDAgMCAwIDZ6TTggMTMuMjMyaDIuNzY4YTEuNSAxLjUgMCAxIDEgMCAzSDh2LTIuNzA3eiIvPgo8L3N2Zz4='); /* Icono de imagen rota o placeholder */
             width: 50px; /* Ajusta el tamaño del icono */
             height: auto;
         }

        .product h3 {
            margin-top: 0;
            margin-bottom: 5px;
            color: #0056b3;
        }
        .product p {
            margin: 5px 0;
            font-size: 0.9em;
            color: #666;
        }
        .product .price {
            font-size: 1.1em;
            color: #28a745;
            font-weight: bold;
            margin: 10px 0;
        }
        .product .sku {
            font-size: 0.8em;
            color: #999;
        }
        footer {
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            color: #666;
            font-size: 0.9em;
        }
    </style>
</head>
<body>

    <header>
        <div class="business-info">
            <img src="https://github.com/rimedhn/demo/blob/main/Logo.png?raw=true" alt="Logotipo del Negocio">
            <br><h1>NOMBRE DE LA EMPRESA</h1>
        </div>
        <p id="welcome-message">¡Bienvenido a nuestro catálogo digital! Descubre nuestra variedad de productos.</p>
        <div class="contact-info">
            <p>Teléfono: +504-9359-3126</p>
            <p>Dirección: Tu Calle, Tu Ciudad, Tu País</p>
        </div>
    </header>

    <div class="container">
        <div id="announcements">
            **¡Anuncio Importante!** Consulta nuestras promociones especiales del mes.
        </div>

        <h2>Explora Nuestros Productos</h2>

        <div class="filter-container" id="filter-buttons">
            </div>

        <div class="catalog" id="product-catalog">
            </div>
    </div>

    <footer>
        &copy; 2023 Nombre de tu Negocio. Todos los derechos reservados.
    </footer>


    
    <script>
        // **IMPORTANTE:** El sheetId obtenido de tu URL proporcionada.
        const sheetId = '1NQE9pPv3uJY4E8tNw5d0ls1QZRM5Ofj9xzhURAgyJq0';
        // Generalmente el gid es 0 para la primera hoja, ajústalo si tu catálogo está en otra hoja.
        const sheetGid = 0;
        const sheetUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&gid=${sheetGid}`;

        const catalogElement = document.getElementById('product-catalog');
        const filterButtonsContainer = document.getElementById('filter-buttons');

        let activeProductsData = []; // Para almacenar solo los datos de los productos 'Activo'

        fetch(sheetUrl)
            .then(response => response.text())
            .then(data => {
                const match = data.match(/google\.visualization\.Query\.setResponse\((.*)\);/);
if (match && match[1]) {
    const json = JSON.parse(match[1]);
    // ... el resto de tu código
} else {
    console.error("No se pudo parsear la respuesta de Google Sheets. Formato inesperado.");
    catalogElement.innerHTML = "<p>Error al cargar el catálogo: formato de datos inesperado.</p>";
    return;
}

                const rows = json.table.rows;
                const columns = json.table.cols.map(col => col.label);

                // Encontrar los índices de las columnas
                const categoryIndex = columns.indexOf('categoria');
                const titleIndex = columns.indexOf('titulo');
                const descriptionIndex = columns.indexOf('descripcion');
                const priceIndex = columns.indexOf('precio');
                const skuIndex = columns.indexOf('sku');
                const imageIndex = columns.indexOf('imagen');
                const statusIndex = columns.indexOf('estado'); // Índice del nuevo campo Estado

                if (categoryIndex === -1 || titleIndex === -1 || descriptionIndex === -1 || priceIndex === -1 || skuIndex === -1 || imageIndex === -1 || statusIndex === -1) {
                    console.error("Error: Asegúrate de que los encabezados de columna sean exactamente 'Categoria', 'Titulo', 'Descripcion', 'Precio', 'SKU', 'Imagen', 'Estado'.");
                    catalogElement.innerHTML = "<p>Error al cargar el catálogo. Por favor, verifica la configuración de la hoja de cálculo y los nombres de las columnas.</p>";
                    return;
                }

                // Iterar sobre las filas (saltando la primera que es el encabezado) y guardar los datos
                for (let i = 1; i < rows.length; i++) {
                    const row = rows[i].c;

                     // Verificar si la fila tiene datos mínimos requeridos
                     if (!row || row.length <= Math.max(categoryIndex, titleIndex, descriptionIndex, priceIndex, skuIndex, imageIndex, statusIndex) || !row[categoryIndex] || !row[categoryIndex].v || !row[titleIndex] || !row[titleIndex].v || !row[statusIndex] || !row[statusIndex].v) {
                         console.warn(`Saltando fila ${i + 1} debido a datos incompletos o faltantes.`);
                         continue; // Salta la fila si no tiene los datos mínimos
                     }

                    const status = row[statusIndex]?.v || '';

                    // **Filtrar por Estado 'Activo'**
                    if (status.toLowerCase() === 'activo') {
                        activeProductsData.push({
                            categoria: row[categoryIndex]?.v || 'Sin Categoría',
                            titulo: row[titleIndex]?.v || 'Sin Título',
                            descripcion: row[descriptionIndex]?.v || 'Sin descripción',
                            precio: row[priceIndex]?.v || 'Precio no disponible',
                            sku: row[skuIndex]?.v || 'Sin SKU',
                            // **NOTA:** La columna Imagen debe contener URLs de imagen DIRECTAS y PÚBLICAS.
                            // Rutas de Google Drive tipo AppSheet NO FUNCIONARÁN AQUÍ.
                            imagen: row[imageIndex]?.v || ''
                        });
                    }
                }

                renderCatalog(activeProductsData); // Renderizar solo los productos activos
                createFilterButtons(activeProductsData); // Crear los botones de filtro basados en productos activos

            })
            .catch(error => {
                console.error('Error al obtener los datos de Google Sheets:', error);
                catalogElement.innerHTML = "<p>Error al cargar el catálogo. Por favor, intenta más tarde.</p>";
            });

        function renderCatalog(productsToRender) {
            catalogElement.innerHTML = ''; // Limpiar el catálogo actual

            // Agrupar productos por categoría
            const productsByCategory = productsToRender.reduce((acc, product) => {
                const category = product.categoria;
                if (!acc[category]) {
                    acc[category] = [];
                }
                acc[category].push(product);
                return acc;
            }, {});

            // Renderizar cada categoría y sus productos
            for (const category in productsByCategory) {
                 // Solo renderizar si hay productos en la categoría después del filtrado
                if (productsByCategory[category].length > 0) {
                    const categoryElement = document.createElement('div');
                    categoryElement.classList.add('category');
                     // Añadir una clase con la categoría para facilitar el filtrado
                    categoryElement.dataset.category = category.replace(/\s+/g, '-').toLowerCase();


                    const categoryTitle = document.createElement('h2');
                    categoryTitle.textContent = category;
                    categoryElement.appendChild(categoryTitle);

                    const catalogGridElement = document.createElement('div');
                    catalogGridElement.classList.add('catalog-grid');

                    productsByCategory[category].forEach(product => {
                        const productElement = document.createElement('div');
                        productElement.classList.add('product');
                         // Añadir una clase con la categoría para facilitar el filtrado
                        productElement.dataset.category = product.categoria.replace(/\s+/g, '-').toLowerCase();


                        productElement.innerHTML = `
                            <img src="${product.imagen}" alt="${product.titulo}">
                            <h3>${product.titulo}</h3>
                            <p>${product.descripcion}</p>
                            <p class="price">${product.precio}</p>
                            <span class="sku">SKU: ${product.sku}</span>
                        `;
                         // Manejar error de carga de imagen
                         const imgElement = productElement.querySelector('img');
                         imgElement.onerror = function() {
                             this.classList.add('error'); // Añade clase para mostrar icono
                             this.alt = 'Imagen no disponible'; // Actualiza texto alternativo
                         };


                        catalogGridElement.appendChild(productElement);
                    });

                    categoryElement.appendChild(catalogGridElement);
                    catalogElement.appendChild(categoryElement);
                }
            }
        }

        function createFilterButtons(products) {
            // Obtener categorías únicas solo de los productos activos
            const categories = [...new Set(products.map(product => product.categoria))];
            filterButtonsContainer.innerHTML = ''; // Limpiar botones existentes

            // Botón "Mostrar Todos"
            const allButton = document.createElement('button');
            allButton.classList.add('filter-button', 'active');
            allButton.textContent = 'Mostrar Todos';
            allButton.dataset.category = 'all'; // Usar un data-category para el botón "Todos"
            allButton.addEventListener('click', () => filterProducts('all'));
            filterButtonsContainer.appendChild(allButton);

            // Botones por categoría
            categories.forEach(category => {
                const button = document.createElement('button');
                button.classList.add('filter-button');
                button.textContent = category;
                button.dataset.category = category.replace(/\s+/g, '-').toLowerCase(); // Guardar categoría en el data attribute
                button.addEventListener('click', () => filterProducts(category.replace(/\s+/g, '-').toLowerCase()));
                filterButtonsContainer.appendChild(button);
            });
        }

        function filterProducts(selectedCategory) {
            const buttons = filterButtonsContainer.querySelectorAll('.filter-button');
            buttons.forEach(button => {
                if (button.dataset.category === selectedCategory) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            });

            const categories = catalogElement.querySelectorAll('.category');
            categories.forEach(categoryElement => {
                 const categoryName = categoryElement.dataset.category;
                if (selectedCategory === 'all' || categoryName === selectedCategory) {
                    categoryElement.style.display = 'block'; // Mostrar la categoría
                     // Mostrar todos los productos dentro de la categoría visible (importante para el caso 'all')
                    const productsInCategory = categoryElement.querySelectorAll('.product');
                     productsInCategory.forEach(productElement => {
                         productElement.style.display = 'flex';
                     });
                } else {
                    categoryElement.style.display = 'none'; // Ocultar la categoría
                }
            });

            // Si se seleccionó una categoría específica, asegurar que solo los productos de esa categoría sean visibles
             if (selectedCategory !== 'all') {
                 categories.forEach(categoryElement => {
                     const categoryName = categoryElement.dataset.category;
                     const productsInCategory = categoryElement.querySelectorAll('.product');
                     productsInCategory.forEach(productElement => {
                        if (categoryName === selectedCategory) {
                             productElement.style.display = 'flex'; // Mostrar productos de la categoría seleccionada
                        } else {
                             productElement.style.display = 'none'; // Ocultar productos de otras categorías (redundante si la categoría está oculta, pero buena práctica)
                        }
                     });
                 });
             }
        }

    </script>

</body>
</html>
